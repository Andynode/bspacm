<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>BSPACM: Framework Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSPACM
   &#160;<span id="projectnumber">20140424</span>
   </div>
   <div id="projectbrief">Board Support Package for ARM Cortex-M Microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Framework Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#framework_cmsis">CMSIS Infrastructure</a><ul><li class="level2"><a href="#framework_cmsis_startup">Startup Infrastructure</a></li>
<li class="level2"><a href="#framework_cmsis_system">System Infrastructure</a></li>
</ul>
</li>
<li class="level1"><a href="#framework_device">Target System Model</a></li>
<li class="level1"><a href="#framework_layout">Directory Structure</a><ul><li class="level2"><a href="#framework_layout_include">Include File Hierarchies</a><ul><li class="level3"><a href="#framework_layout_include_internal">Templates and Internal Include Files</a></li>
<li class="level3"><a href="#framework_layout_include_search">Include Search Order</a></li>
</ul>
</li>
<li class="level2"><a href="#framework_layout_src">Source File Hierarchies</a></li>
<li class="level2"><a href="#framework_layout_bd">Board and Device Hierarchies</a><ul><li class="level3"><a href="#framework_layout_bd_board">Board Hierarchy</a></li>
<li class="level3"><a href="#framework_layout_bd_device">Device Hierarchy</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#framework_make">Makefile Architecture</a><ul><li class="level2"><a href="#framework_make_variables">Variables Used in Building Applications</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>The fundamental architecture of BSPACM is based on the following assumptions:</p>
<ul>
<li>Vendor-provided <a href="http://www.arm.com/products/processors/cortex-m/cortex-microcontroller-software-interface-standard.php">CMSIS</a> headers. CMSIS defines standard names for exception handlers, <code>struct</code> data layouts for core and peripheral registers, standard "intrinsics" such as <code>__disable_irq()</code> and <code>__WFI()</code>, global variables like <code>SystemCoreClock</code> and functions like <code>SystemCoreClockUpdate()</code>. Most vendors readily supply the necessary headers, along with the documentation required to use them.</li>
</ul>
<ul>
<li>Toolchain support for <a href="http://en.wikipedia.org/wiki/Weak_symbol">weak symbols</a>: This feature is used to provide default implementations for <a class="el" href="newlib.html#newlib_sys">newlib's system interface</a> as well as for all handlers supported by a processor's vector table. Vendor libraries and application object files are ordered so that the desired definition will supersede the weak definition when necessary.</li>
</ul>
<ul>
<li>Toolchain support for inline functions: For speed many functions are defined as static functions in headers, with a toolchain-specific <a class="el" href="core_8h.html#a1d7c3e78ed005aa264211e43bf2a64c5">BSPACM_CORE_INLINE</a> or <a class="el" href="core_8h.html#a33aec9db511c37252fe188e680170085">BSPACM_CORE_INLINE_FORCED</a> annotation to ensure that the implementation is inlined.</li>
</ul>
<ul>
<li>Toolchain support for linker optimizations, including placing each function and data object in its own section (gcc <code>-ffunction-sections</code> and <code>-fdata-sections</code>), and eliminating unreferenced sections from the executable (gcc <code>-Wl</code>,-gc-sections).</li>
</ul>
<ul>
<li>The <a href="http://www.gnu.org/software/make/">GNU <code>make</code></a> build tool.</li>
</ul>
<h1><a class="anchor" id="framework_cmsis"></a>
CMSIS Infrastructure</h1>
<p><a href="http://www.arm.com/products/processors/cortex-m/cortex-microcontroller-software-interface-standard.php">CMSIS</a> provides core header files for each Cortex-M architecture, as well as a standard for vendor-specific peripheral interfaces. It also defines the names for exception handlers and core support functions, and provides example implementations of startup and system initialization code for each architecture.</p>
<p>Where vendor-supplied CMSIS support is adequate the vendor files are used. In other situations CMSIS standard implementations direct from ARM are used.</p>
<h2><a class="anchor" id="framework_cmsis_startup"></a>
Startup Infrastructure</h2>
<p>BSPACM provides its own linker scripts and startup assembly files that derive from the ARM examples. These scripts are shared by all applications; customization is performed through BSPACM support for weak symbols and preprocessor flags. BSPACM changes to support this generality includes:</p>
<ul>
<li>In the linker script device-specific memory regions are included from an external file, the location of which is provided by the <code>DEVICE_LDSCRIPT_PATH</code> in <code>make</code>.</li>
</ul>
<ul>
<li>In the startup source the vector table is described by including a device-specific template file which specifies the order and names of entries in the table.</li>
</ul>
<ul>
<li>In the startup source the vector table is initialized with weak definitions for all peripheral exception handlers. These may be replaced by the application by simply providing a non-weak definition using the CMSIS standard name for the exception handler (e.g., <code>SysTick_Handler</code> and <code>UART0_IRQHandler</code>, not <code>SysTickIntHandler</code> or <code>UARTIntHandler</code>).</li>
</ul>
<ul>
<li>By default, the vector table gets a unique weak definition for each entry, allowing unexpected IRQs to be identified. A small amount of space can be regained by overriding the value of <code>__STARTUP_USE_UNIQUE_DEFAULT_HANDLER</code> when the startup files are assembled.</li>
</ul>
<h2><a class="anchor" id="framework_cmsis_system"></a>
System Infrastructure</h2>
<p>CMSIS specifies a number of standard variables and functions that are to be provided by the vendor. Among these are:</p>
<ul>
<li><code>SystemCoreClock</code> is a <code>uint32_t</code> global which represents the processor speed in Hertz.</li>
</ul>
<ul>
<li><code>SystemInit()</code> is a function that is called within the startup code to initialize the clocks (and <code>SystemCoreClock</code>) prior to invoking constructors and calling <code>main()</code>.</li>
</ul>
<ul>
<li><code>SystemCoreClockUpdate()</code> is a function that reads the clock peripheral configuration and updates the value of <code>SystemCoreClock</code>.</li>
</ul>
<p>BSPACM is written with the expectation that these and similar standard functions and data objects exist and may be used.</p>
<p>At this time Texas Instruments does not support CMSIS, so a minimum generic <code>system_TM4C.c</code> is provided in the TM4C device series area.</p>
<p>Although Silicon Labs (Energy Micro) does provide a CMSIS startup file, its <code>SystemInit()</code> fails to initialize <code>SystemCoreClock</code>. At this time, BSPACM has not chosen to fix this error locally.</p>
<h1><a class="anchor" id="framework_device"></a>
Target System Model</h1>
<p>BSPACM targets systems designed around ARM Cortex-M series microprocessors. The intent is that all architecture variations within Cortex-M will be supported: at the time of writing that includes Cortex-M0+, Cortex-M3, and Cortex-M4 devices.</p>
<p>To share implementation and concepts among the widest possible range of target platforms, the following taxonomy is used:</p>
<ul>
<li>A <b>board</b> consists of a specific Cortex-M device along with supporting hardware such as LEDs, sensors, debug interfaces, etc. Examples of boards are the <a href="http://www.ti.com/tool/ek-tm4c123gx">Texas Instruments Tiva Launchpad</a> and <a href="http://www.silabs.com/products/mcu/lowpower/pages/efm32gg-stk3700.aspx">Silicon Labs EFM32 Giant Gecko Starter Kit</a>. Part of the description of a board includes its <em>device</em>.</li>
</ul>
<ul>
<li>A <b>device</b> is a specific Cortex-M microcontroller, with its peripherals, FLASH and SRAM sizes, etc. Examples of devices are the <a href="http://www.ti.com/product/tm4c123gh6pm">TM4C123GH6PM</a> and the <b>EFM32GG990F1024</b>. Each device is an instance within a vendor <em>device line</em>.</li>
</ul>
<ul>
<li>A <b>device line</b> is the next generalization of Cortex-M microcontrollers from a specific vendor. These comprise the set of devices that share common properties, such as Cortex-M architecture and the set of supported peripherals (some of which may not be present on some devices). Examples of device lines are the <a href="http://www.ti.com/lsds/ti/microcontroller/tiva_arm_cortex/c_series/tm4c123x_series/overview.page">TM4C123</a> and <a href="http://www.silabs.com/products/mcu/lowpower/pages/efm32gg-giant-gecko.aspx">EFM32GG "Giant Gecko"</a>. A device line is a refinement of a <em>device series</em>.</li>
</ul>
<ul>
<li>A <b>device series</b> is the highest level of abstraction supported by BSPACM for aggregation of related microcontrollers. These comprise the set of device lines that share common properties, such as vendor and overall purpose. Examples of device series are the <a href="http://www.ti.com/lsds/ti/microcontroller/tiva_arm_cortex/c_series/overview.page">TM4C Tiva C Series</a> and <a href="http://www.silabs.com/products/mcu/lowpower/Pages/default.aspx#32-bit">EFM32 Energy Micro</a> product lines.</li>
</ul>
<p>A BSPACM application is built for a specific board, by providing the <code>BOARD</code> <code>make</code> variable when compiling it. All further information not explicitly provided by the application is derived from the board identification.</p>
<h1><a class="anchor" id="framework_layout"></a>
Directory Structure</h1>
<p>The structure of the BSPACM workspace reflects the taxonomy in <a class="el" href="framework.html#framework_device">Target System Model</a>. You can browse the current directory structure through the <a href="https://github.com/pabigot/bspacm">BSPACM github project page</a>.</p>
<ul>
<li>The <a class="el" href="framework.html#framework_layout_bd_board"><code>board</code> </a> directory contains subdirectories for each supported board. The manufacturer's preferred name for the board, in lower case, should be used as the subdirectory name.</li>
</ul>
<ul>
<li>The <a class="el" href="framework.html#framework_layout_bd_device"><code>device</code> </a> directory contains a series of subdirectories: each series contains subdirectories for each of its lines, which in turn contain subdirectories for each of its devices. Again the manufacturer's preferred name, in lower case, is used for each directory.</li>
</ul>
<ul>
<li>the <a class="el" href="framework.html#framework_layout_include"><code>include</code> </a> directory contains a hierarchy of C header files that will be located using angle-bracket include directives in C sources. The top level contains only a subdirectory <code>bspacm</code>, ensuring that each included file is associated with the BSPACM namespace and does not conflict with vendor or third-party libraries.</li>
</ul>
<ul>
<li>the <a class="el" href="framework.html#framework_layout_src"><code>src</code> </a> directory contains a hierarchy of C implementation files. Source directories are further refined to reflect the include files for which they provide implementation.</li>
</ul>
<ul>
<li>the <code>toolchain</code> directory contains material specific to the compiler/linker toolchain, using the CMSIS standard toolchain identifiers <code>GCC</code> (<a href="https://launchpad.net/gcc-arm-embedded">GNU Tools for ARM Embedded Processors</a>) and the unsupported toolchains <code>ARM</code>, <code>G++</code>, and <code>IAR</code>. Each toolchain directory will contain material such as linker scripts and CMSIS-standard assembly language startup sources for each Cortex-M architecture.</li>
</ul>
<p>The <code>include</code> and <code>src</code> directories are reproduced as necessary within the board and device hierarchies so that specific implementations are associated with the most general level to which they apply.</p>
<p>Other directories such as <code>examples</code>, <code>doc</code>, and <code>maintainer</code> are either self-explanatory or not relevant to most users.</p>
<h2><a class="anchor" id="framework_layout_include"></a>
Include File Hierarchies</h2>
<p>All header files in BSPACM are placed so that they are included with the angle-bracket version of C's <code>#include</code> preprocessor directive with the leading <code>bspacm</code> enforcing placement in a namespace.</p>
<ul>
<li>&lt;<a class="el" href="core_8h.html" title="Common header included by all BSPACM leaf headers. ">bspacm/core.h</a>&gt; is the primary entry point to BSPACM, bringing in the device-specific files and key macros and inline functions.</li>
</ul>
<ul>
<li>&lt;<a class="el" href="config_8h.html" title="Application/board-specific header. ">bspacm/config.h</a>&gt; provides declarations for peripherals and other functionality available on the board for which the application is built. It in turn includes the header &lt;bspacm/appconf.h&gt; which may be overridden on a per-application basis, but which is provided by the board-specific hierarchy when this is unnecessary.</li>
</ul>
<ul>
<li>The <code>bspacm/utility</code> hierarchy provides common interface to non-peripheral capabilities, such as &lt;<a class="el" href="led_8h.html" title="Generic interface to LEDs. ">bspacm/utility/led.h</a>&gt;.</li>
</ul>
<ul>
<li>The <code>bspacm/periph</code> hierarchy provides common interface to peripherals such as <a class="el" href="periph_2uart_8h.html">UARTs</a>, SPI, I2C, timers, real-time clocks, etc.</li>
</ul>
<ul>
<li>The <code>bspacm/newlib</code> hierarchy provides access to BSPACM's <a class="el" href="newlib.html">Interfacing with newlib (libc)</a> support infrastructure.</li>
</ul>
<p>Other directories and files may be added over time.</p>
<h3><a class="anchor" id="framework_layout_include_internal"></a>
Templates and Internal Include Files</h3>
<p>The <code>bspacm/internal</code> hierarchy provides header files that should not be made visible in public API for various reasons. Internal header files named <code><em>something</em>.inc</code> are template files that are included into headers or implementation files, possibly multiple times, to specialize code or data structures for specific purposes, such as defining a standard IRQHandler function or filling out a device description table.</p>
<h3><a class="anchor" id="framework_layout_include_search"></a>
Include Search Order</h3>
<p>Multiple <code>include/bspacm</code> hierarchies may combine to produce the environment used for a particular application. The application may add its own hierarchy first, but the core <code>make</code> infrastructure will also search the board, device, device line, and device series (in that order) before falling back to the generic hierarchy. Device-specific template (<code></code>.inc) and header files are found within the extended set of hierarchies.</p>
<h2><a class="anchor" id="framework_layout_src"></a>
Source File Hierarchies</h2>
<p>Implementation files are placed into subdirectories of <code>src</code> corresponding to the header file that they implement.</p>
<p>As with include files, there are specific source directories available at the board, device, device line, and device series layers as well as the application. Unlike include files, there is no ordered searching within these directories: the full path to each implementation file that contributes to an application are added to the list of source files by one of the Makefile components. See <a class="el" href="framework.html#framework_make">Makefile Architecture</a>.</p>
<h2><a class="anchor" id="framework_layout_bd"></a>
Board and Device Hierarchies</h2>
<h3><a class="anchor" id="framework_layout_bd_board"></a>
Board Hierarchy</h3>
<p>The <code>board</code> hiearchy contains subdirectories for each supported board, identified by the manufacturer's preferred name, in lower case. This identifier is also used as the value of the <code>BOARD</code> variable in the <a class="el" href="framework.html#framework_make">Makefile architecture</a>.</p>
<p>Within each board directory should be the following files:</p>
<dl class="section user"><dt>Makefile.board</dt><dd></dd></dl>
<p>Set the board identifier in the <code>BOARD</code> make variable. Then include the appropriate <code>Makefile.device</code> from the device hierarchy, with an absolute path generally beginning with <code>$(BSPACM_ROOT)</code>.</p>
<p>Any other board- or device-specific make variables may also be set. Generally these should begin with the prefix <code>BOARD_</code>. For example, <code>BOARD_STYLE</code> is used in EFM32 boards to distinguish DK (development kit) from STK (starter kit).</p>
<dl class="section user"><dt><code>README</code> </dt><dd></dd></dl>
<p>Contain salient information about the board: a link to manufacturer's home page, basic characteristics like flash/RAM sizes, pin assignments for LEDs, buttons, and console UART, and whatever else might be useful. Don't repeat information that can easily be found elsewhere; don't make the reader go hunting for the most basic information.</p>
<p>This file may have a suffix such as <code></code>.md (<a href="https://daringfireball.net/projects/markdown/">Markdown</a>), <code></code>.rst (<a href="http://docutils.sourceforge.net/rst.html">reStructuredText</a>), or <code></code>.txt (plain text) identifying the text markup style used within the file.</p>
<dl class="section user"><dt>include/bspacm/appconf.h</dt><dd></dd></dl>
<p>A header file included by &lt;<a class="el" href="config_8h.html" title="Application/board-specific header. ">bspacm/config.h</a>&gt; that provides declarations related for common peripherals such as the default UART device. It may be copied to the application source directory and modified to meet specific application needs.</p>
<p>The contents of this file should be synchronized with the corresponding <code>src/periph_config.c</code> file.</p>
<dl class="section user"><dt>src/periph_config.c</dt><dd></dd></dl>
<p>An implementation file that provides definitions for common peripherals such as the default UART device. The <code>PERIPH_CONFIG_SRC</code> variable used by <a class="el" href="framework.html#framework_make">Makefile Architecture</a> defaults to the version supplied here, but it may be overridden to provide an application-specific implementation.</p>
<dl class="section user"><dt>include/bspacm/internal/board/led.inc</dt><dd></dd></dl>
<p>A template file included by device-specific header and implementation files to describe the LEDs that are available on the board.</p>
<h3><a class="anchor" id="framework_layout_bd_device"></a>
Device Hierarchy</h3>
<p>The device hierarchy contains (recursively) information on each device series, line, and specific device supported in the baseline BSPACM infrastructure. At the top level is the device series, identified by the manufacturer's preferred name.</p>
<p>Each layer in the hierarchy has <a class="el" href="framework.html#framework_layout_include"><code>include</code> </a> and <a class="el" href="framework.html#framework_layout_src"><code>src</code> </a> subdirectories that provide interface and implementation specific to that layer. In addition, the following files are found at various levels in this hierarchy:</p>
<dl class="section user"><dt>Makefile.device</dt><dd></dd></dl>
<p>This file is necessarily found at the device layer of the hierarchy (e.g., <code>device/efm32/efm32gg/efm32gg990f256/Makefile.device</code>).</p>
<p>Set the device identifier in the <code>DEVICE</code> make variable. Provide definitions for <code>TARGET_MFLAGS</code>, <code>TARGET_CPPFLAGS</code>, <code>ARM_PROCESSOR</code>, and other variables that cannot be defined at the line or series levels.</p>
<p>End by including the appropriate <code>Makefile.line</code> from the device hierarchy, with an absolute path generally beginning with <code>$(BSPACM_ROOT)</code>.</p>
<dl class="section user"><dt>Makefile.line</dt><dd></dd></dl>
<p>This file is necessarily found at the line layer of the hierarchy (e.g., <code>device/efm32/efm32gg/Makefile.line</code>).</p>
<p>Set the device line identifier in the <code>DEVICE_LINE</code> make variable. Provide definitions for <code>TARGET_MFLAGS</code>, <code>TARGET_CPPFLAGS</code>, <code>ARM_PROCESSOR</code>, and other variables that cannot be defined at the series level.</p>
<p>Then include the appropriate <code>Makefile.series</code> from the device hierarchy, with an absolute path generally beginning with <code>$(BSPACM_ROOT)</code>.</p>
<dl class="section user"><dt>Makefile.series</dt><dd></dd></dl>
<p>This file is necessarily found at the series layer of the hierarchy (e.g., <code>device/efm32/Makefile.series</code>).</p>
<p>Set the device line identifier in the <code>DEVICE_LINE</code> make variable. Provide defaults for <code>TARGET_MFLAGS</code>, <code>TARGET_CPPFLAGS</code>, <code>ARM_PROCESSOR</code>, and other variables that have not already been defined.</p>
<p>Define <code>BOARD_LIBVENDOR_A</code> to the archive file for vendor libraries such as <a href="http://www.ti.com/tool/sw-tm4c">TivaWare</a> or <a href="http://cdn.energymicro.com/dl/documentation/doxygen/EM_CMSIS_3.20.2_DOC/index.html">emlib</a>. Provide the necessary <code>make</code> rules to build that archive.</p>
<p>Append to <code>BOARD_LIBBSPACM_SRC</code> any device-specific implementation files.</p>
<p>Define a command <code>DO_FLASH_IMAGE</code> which takes a single argument that is the name of an ARM binary and programs it into the board.</p>
<dl class="section user"><dt>memory.ld</dt><dd></dd></dl>
<p>A file for the GCC toolchain describing the memory regions, i.e. size of flash and ram available on the device. The file will be included into the generic linker script for the processor.</p>
<p>Generally this is found at the device (deepest) level. If it is not placed there, the <code>DEVICE_LDSCRIPT_PATH</code> <code>make</code> variable must be defined to instruct the linker where it can be found.</p>
<dl class="section user"><dt>include/bspacm/internal/device/vector_table.inc</dt><dd></dd></dl>
<p>A file describing the entries in the interrupt vector table for the device, in a form suitable for inclusion into linker scripts and/or startup sources. The file wraps the standard names, in order, with a macro that is expanded in context to create a CMSIS standard <code>*_IRQHandler</code> definition or reference.</p>
<p>Generally this is found at the line level.</p>
<dl class="section user"><dt>include/bspacm/internal/periph</dt><dd></dd></dl>
<p>A directory containing template files included by device-specific header and implementation files to declare or define specific peripherals. The files should have a base name corresponding to the peripheral; e.g. <code><a class="el" href="usart_8inc.html" title="Include file to define USART instances for EFM32 devices. ">usart.inc</a></code> or <code><a class="el" href="leuart_8inc.html" title="Include file to define LEUART instances for EFM32 devices. ">leuart.inc</a></code>.</p>
<h1><a class="anchor" id="framework_make"></a>
Makefile Architecture</h1>
<p>BSPACM uses GNU make features to simplify the build process at the cost of increased maintainer complexity.</p>
<p>Each application has its own <code>Makefile</code> which initializes the <code>SRC</code> variable to the list of application-specific sources, then includes <code>$(BSPACM_ROOT)/make/Makefile.common</code>. That file then includes board and device specific files, constructs compiler and linker arguments, and provides the rules necessary to build the libraries, object files, and application itself.</p>
<p>BSPACM's <code>make</code> infrastructure preprocesses source files to determine dependencies, and automatically rebuilds all files that are affected by source code changes.</p>
<p>Object files specific to an application, including the startup and system modules from CMSIS, are compiled and stored in the current directory alongside the Makefile. Object files and libraries that should be independent of the application are stored in the BSPACM board directory.</p>
<p>Standard targets include:</p>
<ul>
<li><code>app.axf</code> builds the application into ELF format </li>
<li><code>install</code> downloads the application to the board, after building it </li>
<li><code>clean</code> removes all application-specific build files. This should be done when rebuilding an application for a new board, as the object files may have invalid references. </li>
<li><code>realclean</code> removes all board-specific build files. This may be necessary when changing code-generation and link-related toolchain flags.</li>
</ul>
<h2><a class="anchor" id="framework_make_variables"></a>
Variables Used in Building Applications</h2>
<p>All <code>make</code> variables should be documented within <code>make/Makefile.common</code> and the reader is directed there for full details. Only the most commonly specified variables are described here. See the various example applications to learn more.</p>
<dl class="section user"><dt><code>SRC</code> </dt><dd></dd></dl>
<p>This variable contains the list of source code files, exclusive of vendor and BSPACM libraries, that contribute to an application. C (<code></code>.c), C++ (<code></code>.cc), and assembly-with-c-preprocessor (<code></code>.S) sources are recognized, and <code>make</code> build rules dynamically created to build the object files and place them in the current directory.</p>
<dl class="section user"><dt><code>BOARD</code> </dt><dd></dd></dl>
<p>This variable must be set to identify the target for the application. The value is the board identifier as specified by the corresponding subdirectory of <code>$(BSPACM_ROOT)/boards</code></p>
<p>Copyright 2014, Peter A. Bigot </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 24 2014 10:01:18 for BSPACM by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
